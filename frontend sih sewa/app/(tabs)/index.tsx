import React, { useState, useRef, useEffect } from 'react';
import { View, Text, ScrollView, TouchableOpacity, StyleSheet, Image, Linking, Animated, Dimensions } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { PlayCircle } from 'lucide-react-native';
import WeatherCard from '@/components/WeatherCard';
import CropRecommendationCard from '@/components/CropRecommendationCard';

const KisanGyanCard = ({ title, description, thumbnail, onPress }) => {
  return (
    <TouchableOpacity style={styles.card} onPress={onPress}>
      <Image source={thumbnail} style={styles.thumbnail} />
      <View style={styles.playIconContainer}>
        <PlayCircle color="#FFFFFF" size={40} />
      </View>
      <View style={styles.textContainer}>
        <Text style={styles.cardTitle} numberOfLines={2}>{title}</Text>
        <Text style={styles.cardDescription} numberOfLines={2}>{description}</Text>
      </View>
    </TouchableOpacity>
  );
};

// Placeholder images
const videoThumbnails = [
  { uri: 'https://placehold.co/400x250/EBF5E9/22C55E?text=Organic+Compost' },
  { uri: 'https://placehold.co/400x250/FDF6ED/F59E0B?text=Pest+Control' },
  { uri: 'https://placehold.co/400x250/E0F2FE/3B82F6?text=Soil+Testing' },
  { uri: 'https://placehold.co/400x250/FFF5F0/FB923C?text=Market+Price' },
  { uri: 'https://placehold.co/400x250/EDE9FE/7C3AED?text=Irrigation+Tips' },
  { uri: 'https://placehold.co/400x250/ECFDF5/10B981?text=Organic+Fertilizer' },
  { uri: 'https://placehold.co/400x250/FEF3C7/F59E0B?text=Seed+Selection' },
  { uri: 'https://placehold.co/400x250/FCE7F3/DB2777?text=Storage+Tips' },
  { uri: 'https://placehold.co/400x250/E0F2FE/3B82F6?text=Market+Trends' },
];

export default function HomeScreen() {
  const [language, setLanguage] = useState('hindi'); 
  const [showMore, setShowMore] = useState(false); 

  const scrollRef = useRef(null);
  const screenWidth = Dimensions.get('window').width;

  const languageTexts = {
    hindi: {
      welcome: 'рдирдорд╕реНрддреЗ рдХрд┐рд╕рд╛рди рднрд╛рдИ!',
      subtitle: 'рдЖрдЬ рдХрд╛ рдореМрд╕рдо рдФрд░ рд╕реБрдЭрд╛рд╡',
      knowledgeHub: 'рдХрд┐рд╕рд╛рди рдЬреНрдЮрд╛рди рдХреЗрдВрджреНрд░',
      extraTitle: 'рдЕрддрд┐рд░рд┐рдХреНрдд рдлрд╕рд▓ рд╕реБрдЭрд╛рд╡',
      extra: [
        'рдорд┐рдЯреНрдЯреА рдХреА рдирд┐рдпрдорд┐рдд рдЬрд╛рдВрдЪ рдХрд░реЗрдВред',
        'рдмреВрдБрдж рд╕рд┐рдВрдЪрд╛рдИ рдФрд░ рдорд▓реНрдЪрд┐рдВрдЧ рдЕрдкрдирд╛рдПрдБред',
        'рджрд▓рд╣рдиреА рдлрд╕рд▓реЛрдВ рдХреЛ cereals рдХреЗ рдмрд╛рдж рдмреЛрдПрдВред',
        'рдХреАрдЯ рдкреНрд░рдмрдВрдзрди рдХреЗ рдкреНрд░рд╛рдХреГрддрд┐рдХ рддрд░реАрдХреЗ рдЕрдкрдирд╛рдПрдБред',
        'рдЕрдкрдиреЗ рдХреНрд╖реЗрддреНрд░ рдХреА рдЬрд▓рд╡рд╛рдпреБ рдЕрдиреБрд╕рд╛рд░ рдлрд╕рд▓ рдЪреБрдиреЗрдВред'
      ],
      kcc: {
        title: 'ЁЯТ│ рдХрд┐рд╕рд╛рди рдХреНрд░реЗрдбрд┐рдЯ рдХрд╛рд░реНрдб (KCC)',
        points: [
          'тАв рдЖрд╕рд╛рди рдФрд░ рд╕рд╕реНрддрд╛ рдХреГрд╖рд┐ рдЛрдг',
          'тАв рдмреНрдпрд╛рдЬ рджрд░ рд╕рд┐рд░реНрдл 4% (рд╕рдмреНрд╕рд┐рдбреА рдХреЗ рдмрд╛рдж)',
          'тАв рдлрд╕рд▓ рдХрдЯрд╛рдИ рдХреЗ рдмрд╛рдж рд▓рдЪреАрд▓рд╛ рднреБрдЧрддрд╛рди'
        ],
        guide: 'ЁЯСЙ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЧрд╛рдЗрдб рджреЗрдЦреЗрдВ',
        loan: 'ЁЯСЙ рдЖрд╡реЗрджрди рдкрддреНрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ'
      },
      ticker: [
        'рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдХрд┐рд╕рд╛рди рд╕рдореНрдорд╛рди рдирд┐рдзрд┐ рдпреЛрдЬрдирд╛ рдЕрдкрдбреЗрдЯ',
        'рдХреГрд╖рд┐ рдореМрд╕рдо рдЪреЗрддрд╛рд╡рдиреА: рдЕрдЧрд▓реЗ 3 рджрд┐рди рдмрд╛рд░рд┐рд╢ рдХреА рд╕рдВрднрд╛рд╡рдирд╛',
        'рдзрд╛рди рдХрд╛ рдмрд╛рдЬрд╛рд░ рднрд╛рд╡: тВ╣2100 рдкреНрд░рддрд┐ рдХреНрд╡рд┐рдВрдЯрд▓',
        'рдЧреЗрд╣реВрдВ рдореЗрдВ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдХреАрдЯ рдкреНрд░рдмрдВрдзрди рдЯрд┐рдкреНрд╕',
        'рд╕рдмреНрд╕рд┐рдбреА рд╡рд╛рд▓реА рд╕реМрд░ рдкрдВрдк рдпреЛрдЬрдирд╛',
        'рдирдИ рдЬреИрд╡рд┐рдХ рдЦрд╛рдж рддрдХрдиреАрдХ',
        'рдорд┐рдЯреНрдЯреА рдкрд░реАрдХреНрд╖рдг рдЕрднрд┐рдпрд╛рди: рдЕрдкрдирд╛ рдлрд╕рд▓ рдкреЛрд╖рдг рдЬрд╛рдБрдЪреЗрдВ',
        'рдХреГрд╖рд┐ рдЛрдг рдХреЗ рд▓рд┐рдП рдЖрд╕рд╛рди рдСрдирд▓рд╛рдЗрди рдЖрд╡реЗрджрди'
      ]
    },
    english: {
      welcome: 'Welcome Farmer!',
      subtitle: "Today's Weather & Recommendations",
      knowledgeHub: 'Farmer Knowledge Hub',
      extraTitle: 'Additional Crop Recommendations',
      extra: [
        'Regularly test your soil for nutrients.',
        'Adopt drip irrigation and mulching.',
        'Rotate legumes after cereals.',
        'Use natural pest management methods.',
        'Choose crops suited to your climate.'
      ],
      kcc: {
        title: 'ЁЯТ│ Kisan Credit Card (KCC)',
        points: [
          'тАв Easy & affordable crop loans',
          'тАв Interest rate only 4% (after subsidy)',
          'тАв Flexible repayment after harvest'
        ],
        guide: 'ЁЯСЙ View Official Guide',
        loan: 'ЁЯСЙ Download Loan Application'
      },
      ticker: [
        'PM Kisan Samman Nidhi latest updates',
        'Weather alert: Rain expected next 3 days',
        'Paddy market price: тВ╣2100 per quintal',
        'Natural pest management tips for wheat',
        'Subsidized solar pump scheme',
        'New organic compost techniques',
        'Soil testing campaign: check crop nutrition',
        'Easy online application for crop loan'
      ]
    },
    punjabi: {
      welcome: 'ри╕рид ри╕рйНри░рйА риЕриХри╛ри▓ риХри┐ри╕ри╛рии риЬрйА!',
      subtitle: 'риЕрй▒риЬ рижри╛ риорйМри╕рио ридрйЗ ри╕рйБриЭри╛риЕ',
      knowledgeHub: 'риХри┐ри╕ри╛рии риЧри┐риЖрии риХрйЗриВрижри░',
      extraTitle: 'ри╡ри╛ризрйВ рилри╕ри▓ ри╕рйБриЭри╛риЕ',
      extra: [
        'риори┐рй▒риЯрйА рижрйА риири┐риприори┐рид риЬри╛риВриЪ риХри░рйЛред',
        'риЯрикрйАриХ ри╕ри┐рй░риЪри╛риИ риЕридрйЗ риори▓риЪри┐рй░риЧ риЕрикригри╛риУред',
        'риЕриири╛риЬ ридрйЛриВ римри╛риЕриж рижри╛ри▓ри╛риВ ри╡риЧрйИри░ри╛ римрйАриЬрйЛред',
        'риХрйАрйЬрйЗ рикрйНри░римрй░ризрии рижрйЗ риХрйБрижри░ридрйА ридри░рйАриХрйЗ ри╡ри░ридрйЛред',
        'риЖрикригрйЗ риЦрйЗридри░ рижрйА риЖримрйЛри╣ри╡ри╛ риорйБридри╛римриХ рилри╕ри▓ риЪрйБригрйЛред'
      ],
      kcc: {
        title: 'ЁЯТ│ риХри┐ри╕ри╛рии риХри░рйИрибри┐риЯ риХри╛ри░риб (KCC)',
        points: [
          'тАв риЖри╕ри╛рии риЕридрйЗ ри╕ри╕ридри╛ риЦрйЗридрйАримри╛рйЬрйА риХри░риЬри╝ри╛',
          'тАв ри╕рйВриж рижри░ ри╕ри┐ри░рил 4% (ри╕римри╕ри┐рибрйА римри╛риЕриж)',
          'тАв рилри╕ри▓ риХриЯри╛риИ ридрйЛриВ римри╛риЕриж ри▓риЪриХрйАри▓ри╛ ринрйБриЧридри╛рии'
        ],
        guide: 'ЁЯСЙ ри╕ри░риХри╛ри░рйА риЧри╛риИриб ри╡рйЗриЦрйЛ',
        loan: 'ЁЯСЙ ри▓рйЛрии риЕрикри▓рйАриХрйЗри╕ри╝рии рибри╛риКриири▓рйЛриб риХри░рйЛ'
      },
      ticker: [
        'рикрйНри░ризри╛рии риорй░ридри░рйА риХри┐ри╕ри╛рии ри╕риириори╛рии риир░┐р░зрйА риЕрикрибрйЗриЯ',
        'риорйМри╕рио риЪрйЗридри╛ри╡риирйА: риЕриЧри▓рйЗ 3 рижри┐риири╛риВ ри╡ри┐рй▒риЪ риорйАриВри╣',
        'ризри╛рии рижри╛ римри╛риЬри╝ри╛ри░ риорйБрй▒ри▓: тВ╣2100 рикрйНри░ридрйА риХри╡ри┐рй░риЯри╛ри▓',
        'риЧрй░ри╣рйБ ри╡ри┐рй▒риЪ риХрйБрижри░ридрйА риХрйАрйЬрйЗ рикрйНри░римрй░ризрии риЯри┐рикри╕',
        'ри╕римри╕ри┐рибрйА ри╡ри╛ри▓ри╛ ри╕рйВри░риЬрйА рикрй░рик рипрйЛриЬриири╛',
        'риири╡рйАриВ риЬрйИри╡ри┐риХ риЦри╛риж ридриХриирйАриХ',
        'риори┐рй▒риЯрйА риЯрйИри╕риЯри┐рй░риЧ риорйБри╣ри┐рй░рио: рилри╕ри▓ рикрйЛри╕ри╝риг риЬри╛ригрйЛ',
        'риЦрйЗридрйА риХри░риЬри╝ри╛ ри▓риИ риЖри╕ри╛рии риЖриири▓ри╛риИрии риЕри░риЬри╝рйА'
      ]
    }
  };

  const kisanGyanContent = [
    { id: '1', title: language==='hindi'?'рдЬреИрд╡рд┐рдХ рдЦрд╛рдж рдХреИрд╕реЗ рдмрдирд╛рдПрдВ':language==='punjabi'?'риЬрйИри╡ри┐риХ риЦри╛риж риХри┐ри╡рйЗриВ римригри╛риЗриЖ риЬри╛ри╡рйЗ':'How to Make Organic Compost', description: language==='hindi'?'рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдЦрд╛рджреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдо рдХрд░реЗрдВ рдФрд░ рдЕрдкрдиреА рдорд┐рдЯреНрдЯреА рдХреЛ рд╕реНрд╡рд╕реНрде рдмрдирд╛рдПрдВред':language==='punjabi'?'ри░ри╕ри╛риЗригриХ риЦри╛рижри╛риВ рижрйА ри╡ри░ридрйЛриВ риШриЯри╛риУ риЕридрйЗ риЖрикригрйА риори┐рй▒риЯрйА риирйВрй░ ри╕ри┐ри╣ридриорй░риж римригри╛риУред':'Reduce chemical use and improve soil health with organic compost.', thumbnail: videoThumbnails[0], link:'https://youtu.be/mkb_iHgKro4?si=kC7BXJ4uDih3qFcl' },
    { id: '2', title: language==='hindi'?'рдкреНрд░рд╛рдХреГрддрд┐рдХ рдХреАрдЯ рдирд┐рдпрдВрддреНрд░рдг':language==='punjabi'?'риХрйБрижри░ридрйА риХрйАрйЬрйЗ риХрй░риЯри░рйЛри▓':'Natural Pest Control', description: language==='hindi'?'рдХреАрдЯрдирд╛рд╢рдХреЛрдВ рдХреЗ рдмрд┐рдирд╛ рдЕрдкрдиреА рдлрд╕рд▓реЛрдВ рдХреЛ рдХреАрдЯреЛрдВ рд╕реЗ рдмрдЪрд╛рдПрдВред':language==='punjabi'?'риХрйАриЯриири╛ри╕ри╝риХри╛риВ ридрйЛриВ римри┐риири╛риВ риЖрикригрйАриЖриВ рилри╕ри▓ри╛риВ риирйВрй░ риХрйАриЯри╛риВ ридрйЛриВ римриЪри╛риУред':'Protect your crops from pests without harmful pesticides.', thumbnail: videoThumbnails[1], link:'https://youtu.be/jB9fhrmkx80?si=uKuuClgXoFXhoBfW' },
    { id: '3', title: language==='hindi'?'рдорд┐рдЯреНрдЯреА рдХреА рдЬрд╛рдВрдЪ рдХреНрдпреЛрдВ рдЬрд░реВрд░реА?':language==='punjabi'?'риори┐рй▒риЯрйА рижрйА риЬри╛риВриЪ риХри┐риЙриВ риЬри╝ри░рйВри░рйА?':'Why Soil Testing is Important?', description: language==='hindi'?'рд╕рд╣реА рдкреЛрд╖рдХ рддрддреНрд╡реЛрдВ рдХреА рдорд╛рддреНрд░рд╛ рдЬрд╛рдиреЗрдВ рдФрд░ рдлрд╕рд▓ рдХреА рдкреИрджрд╛рд╡рд╛рд░ рдмрдврд╝рд╛рдПрдВред':language==='punjabi'?'ри╕ри╣рйА рикрйМри╕ри╝риЯри┐риХ ридрй▒ридри╛риВ рижрйА риори╛ридри░ри╛ риЬри╛ригрйЛ риЕридрйЗ рилри╕ри▓ рижрйА рикрйИрижри╛ри╡ри╛ри░ ри╡ризри╛риУред':'Learn about nutrient levels to maximize your crop yield.', thumbnail: videoThumbnails[2], link:'https://youtu.be/xJKMhmBqgRA?si=mvcYni1cyYR1Upwl' },
    { id: '4', title: language==='hindi'?'рдзрд╛рди рдХрд╛ рдмрд╛рдЬрд╛рд░ рднрд╛рд╡':language==='punjabi'?'ризри╛рии рижри╛ римри╛риЬри╝ри╛ри░ риорйБрй▒ри▓':'Paddy Market Price', description: language==='hindi'?'рдЖрдЬ рдХрд╛ рдордВрдбреА рднрд╛рд╡ рджреЗрдЦреЗрдВ рдФрд░ рдЕрдкрдиреЗ рдирд┐рд░реНрдгрдп рд▓реЗрдВред':language==='punjabi'?'риЕрй▒риЬ рижри╛ римри╛риЬри╝ри╛ри░ риорйБрй▒ри▓ ри╡рйЗриЦрйЛ риЕридрйЗ рилрйИри╕ри▓ри╛ риХри░рйЛред':'Check todayтАЩs market price to make informed decisions.', thumbnail: videoThumbnails[3], link:'https://www.agmarknet.gov.in/' },
    { id: '5', title: language==='hindi'?'рд╕рд┐рдВрдЪрд╛рдИ рд╕реБрдЭрд╛рд╡':language==='punjabi'?'ри╕ри┐рй░риЪри╛риИ ри╕рйБриЭри╛риЕ':'Irrigation Tips', description: language==='hindi'?'рдЬрд▓ рдХрд╛ рдХреБрд╢рд▓ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗред':language==='punjabi'?'рикри╛ригрйА рижрйА ри╕риори░рие ри╡ри░ридрйЛриВ рижрйЗ ридри░рйАриХрйЗред':'Ways to use water efficiently.', thumbnail: videoThumbnails[4], link:'https://www.indiawaterportal.org/' },
    { id: '6', title: language==='hindi'?'рдЬреИрд╡рд┐рдХ рдЙрд░реНрд╡рд░рдХ':language==='punjabi'?'риЬрйИри╡ри┐риХ риЦри╛риж':'Organic Fertilizer', description: language==='hindi'?'рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдЙрд░реНрд╡рд░рдХреЛрдВ рдХреЗ рдмрд┐рдирд╛ рдлрд╕рд▓ рдмрдврд╝рд╛рдПрдВред':language==='punjabi'?'ри░ри╕ри╛риЗригриХ риЦри╛рижри╛риВ рижрйЗ римри┐риири╛риВ рилри╕ри▓ ри╡ризри╛риУред':'Increase yield without chemical fertilizers.', thumbnail: videoThumbnails[5], link:'https://www.fao.org/' },
    { id: '7', title: language==='hindi'?'рдмреАрдЬ рдЪрдпрди':language==='punjabi'?'римрйАриЬ риЪрйЛриг':'Seed Selection', description: language==='hindi'?'рдлрд╕рд▓ рдХреЗ рд▓рд┐рдП рдЙрддреНрддрдо рдмреАрдЬ рдЪреБрдиреЗрдВред':language==='punjabi'?'рилри╕ри▓ ри▓риИ риЪрй░риЧрйЗ римрйАриЬ риЪрйБригрйЛред':'Select best seeds for your crop.', thumbnail: videoThumbnails[6], link:'https://www.seednet.gov.in/' },
    { id: '8', title: language==='hindi'?'рднрдВрдбрд╛рд░рдг рд╕реБрдЭрд╛рд╡':language==='punjabi'?'ри╕риЯрйЛри░рйЗриЬ ри╕рйБриЭри╛риЕ':'Storage Tips', description: language==='hindi'?'рдлрд╕рд▓ рдХреЛ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рднрдВрдбрд╛рд░рд┐рдд рдХрд░реЗрдВред':language==='punjabi'?'рилри╕ри▓ риирйВрй░ ри╕ри╣рйА ридри░рйАриХрйЗ риири╛ри▓ ри╕риЯрйЛри░ риХри░рйЛред':'Store your harvest properly.', thumbnail: videoThumbnails[7], link:'https://www.fao.org/' },
    { id: '9', title: language==='hindi'?'рдмрд╛рдЬрд╝рд╛рд░ рдкреНрд░рд╡реГрддреНрддрд┐рдпрд╛рдБ':language==='punjabi'?'римри╛риЬри╝ри╛ри░ ри░рйБриЭри╛рии':'Market Trends', description: language==='hindi'?'рдордВрдбреА рдХреЗ рд░реБрдЭрд╛рди рдкрд░ рдирдЬрд░ рд░рдЦреЗрдВред':language==='punjabi'?'риорй░рибрйА рижрйЗ ри░рйБриЭри╛рии ридрйЗ ризри┐риЖрии ри░рй▒риЦрйЛред':'Keep track of market trends.', thumbnail: videoThumbnails[8], link:'https://www.agmarknet.gov.in/' },
  ];

  const currentTexts = languageTexts[language];

  // Ticker Animation
  const [tickerWidth, setTickerWidth] = useState(0);
  const scrollAnim = useRef(new Animated.Value(screenWidth)).current;

  useEffect(() => {
    if (tickerWidth === 0) return;

    const animateTicker = () => {
      scrollAnim.setValue(screenWidth);
      Animated.timing(scrollAnim, {
        toValue: -tickerWidth,
        duration: 60000, // slower for better readability
        useNativeDriver: true,
        isInteraction: false,
      }).start(() => animateTicker());
    };

    animateTicker();
  }, [tickerWidth, scrollAnim, currentTexts]);

  // Horizontal scroll buttons
  const scrollBy = (offset) => {
    scrollRef.current?.scrollTo({ x: offset, animated: true });
  };

  return (
    <SafeAreaView style={styles.container}>
      <ScrollView showsVerticalScrollIndicator={false}>
        {/* Header */}
        <View style={styles.header}>
          <View style={styles.headerContent}>
            <Text style={styles.welcomeText}>{currentTexts.welcome}</Text>
            <Text style={styles.subtitleText}>{currentTexts.subtitle}</Text>
          </View>
          <TouchableOpacity 
            style={styles.languageButton}
            onPress={() => {
              const languages = ['hindi', 'english', 'punjabi'];
              const currentIndex = languages.indexOf(language);
              const nextIndex = (currentIndex + 1) % languages.length;
              setLanguage(languages[nextIndex]);
            }}
          >
            <Text style={styles.languageButtonText}>
              {language === 'hindi' ? 'рд╣рд┐рдВрджреА' : language === 'punjabi' ? 'рикрй░риЬри╛римрйА' : 'English'}
            </Text>
          </TouchableOpacity>
        </View>

        {/* Kisan Gyan Kendra Section */}
        <View style={styles.section}>
          <Text style={styles.sectionTitle}>{currentTexts.knowledgeHub}</Text>
          <View style={{ flexDirection: 'row', alignItems: 'center' }}>
            <TouchableOpacity onPress={() => scrollBy(-screenWidth)} style={styles.scrollButton}>
              <Text style={{fontSize: 20}}>{'<'}</Text>
            </TouchableOpacity>
            <ScrollView
              horizontal
              ref={scrollRef}
              showsHorizontalScrollIndicator={false}
              style={styles.horizontalScroll}
            >
              {kisanGyanContent.map(item => (
                <KisanGyanCard
                  key={item.id}
                  title={item.title}
                  description={item.description}
                  thumbnail={item.thumbnail}
                  onPress={() => Linking.openURL(item.link)}
                />
              ))}

              {/* KCC Scheme Box */}
              <View style={styles.schemeBox}>
                <Text style={styles.schemeTitle}>{currentTexts.kcc.title}</Text>
                {currentTexts.kcc.points.map((p, i) => (
                  <Text key={i} style={styles.schemeText}>{p}</Text>
                ))}
                <TouchableOpacity onPress={() => Linking.openURL("https://www.jansamarth.in/kisan-credit-card-scheme")}>
                  <Text style={styles.schemeLink}>{currentTexts.kcc.guide}</Text>
                </TouchableOpacity>
                <TouchableOpacity onPress={() => Linking.openURL("https://pmkisan.gov.in/documents/Kcc.pdf")}>
                  <Text style={styles.schemeLink}>{currentTexts.kcc.loan}</Text>
                </TouchableOpacity>
              </View>
            </ScrollView>
            <TouchableOpacity onPress={() => scrollBy(screenWidth)} style={styles.scrollButton}>
              <Text style={{fontSize: 20}}>{'>'}</Text>
            </TouchableOpacity>
          </View>
        </View>

        {/* Scrolling Ticker */}
        <View style={styles.tickerContainer}>
          <Animated.Text
            onLayout={(e) => setTickerWidth(e.nativeEvent.layout.width)}
            style={[styles.tickerText, { transform: [{ translateX: scrollAnim }] }]}
          >
            {currentTexts.ticker.join('     ||     ')}     ||     
          </Animated.Text>
        </View>

        {/* Weather Card */}
        <WeatherCard language={language} />

        {/* Crop Recommendations */}
        <CropRecommendationCard 
          language={language} 
          onViewMore={() => setShowMore(!showMore)} 
        />

        {/* Dropdown extra info */}
        {showMore && (
          <View style={styles.dropdownBox}>
            <Text style={styles.dropdownTitle}>{currentTexts.extraTitle}</Text>
            {currentTexts.extra.map((tip, index) => (
              <Text key={index} style={styles.dropdownItem}>тАв {tip}</Text>
            ))}
          </View>
        )}
      </ScrollView>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#F9FAFB' },
  header: {
    flexDirection: 'row', justifyContent: 'space-between',
    alignItems: 'center', paddingHorizontal: 20, paddingVertical: 20,
    backgroundColor: '#FFFFFF', marginBottom: 10,
  },
  headerContent: { flex: 1 },
  welcomeText: { fontSize: 24, fontWeight: '700', color: '#1F2937', marginBottom: 4 },
  subtitleText: { fontSize: 16, color: '#6B7280' },
  languageButton: { backgroundColor: '#22C55E', paddingHorizontal: 16, paddingVertical: 8, borderRadius: 20 },
  languageButtonText: { color: '#FFFFFF', fontWeight: '600', fontSize: 14 },
  section: { paddingBottom: 20 },
  sectionTitle: { fontSize: 20, fontWeight: '700', color: '#1F2937', marginBottom: 16, paddingHorizontal: 20 },
  horizontalScroll: { paddingHorizontal: 10 },
  card: {
    width: 200, marginRight: 16, borderRadius: 12, backgroundColor: '#FFFFFF',
    overflow: 'hidden', elevation: 2, shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 }, shadowOpacity: 0.1, shadowRadius: 4,
  },
  thumbnail: { width: '100%', height: 120, resizeMode: 'cover' },
  playIconContainer: { position: 'absolute', top: 0, left: 0, right: 0, bottom: 0,
    justifyContent: 'center', alignItems: 'center', backgroundColor: 'rgba(0,0,0,0.3)' },
  textContainer: { padding: 12 },
  cardTitle: { fontSize: 16, fontWeight: '600', color: '#1F2937', marginBottom: 4 },
  cardDescription: { fontSize: 12, color: '#6B7280' },
  dropdownBox: {
    marginHorizontal: 20, marginTop: -10, marginBottom: 20,
    backgroundColor: '#FFFFFF', borderRadius: 12, padding: 16,
    elevation: 2, shadowColor: '#000', shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1, shadowRadius: 4,
  },
  dropdownTitle: { fontSize: 16, fontWeight: '700', color: '#1F2937', marginBottom: 8 },
  dropdownItem: { fontSize: 14, color: '#4B5563', marginBottom: 4 },
  schemeBox: {
    width: 200, marginLeft: 10, backgroundColor: '#FFF',
    borderRadius: 12, padding: 12, elevation: 2,
    shadowColor: '#000', shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1, shadowRadius: 4,
  },
  schemeTitle: { fontSize: 14, fontWeight: '700', marginBottom: 6, color: '#1F2937' },
  schemeText: { fontSize: 12, color: '#4B5563', marginBottom: 4 },
  schemeLink: { fontSize: 12, color: '#2563EB', fontWeight: '600', marginTop: 4 },
  scrollButton: { padding: 10, backgroundColor:'#D1FAE5', borderRadius: 8, marginHorizontal: 2 },
  tickerContainer: {
    width: '100%',
    backgroundColor: '#A7F3D0',
    paddingVertical: 12,
    overflow: 'hidden',
    marginBottom: 10,
  },
  tickerText: {
    fontSize: 16,
    color: '#7C4519',
    fontWeight: '600',
    whiteSpace: 'nowrap',
  },
});
